/*!
CMSMS OneEleven theme functions v.1.2
(C) 2014-2023 CMS Made Simple Foundation <foundation@cmsmadesimple.org>
License GPL2+
*/
!function(e,$){"use strict";var t=e.OE={};$(function(){t.helper.init(),t.view.init()}),t.helper={init:function(){$("a[rel=external]").attr("target","_blank"),$("input.defaultfocus, input[autofocus]").eq(0).trigger("focus"),this._isLocalStorage()||this.loadScript("themes/OneEleven/includes/jquery.cookie.min.js")},loadScript:function(e,t,n){var a=!0,o=null;return"function"==typeof t?(o=t,a=n||a):(a=t||a,o=n||o),$('script[type="text/javascript"]').each(function(){return e!==$(this).attr("src")}),$.ajax(e,{dataType:"script",async:!1,cache:a}).done(o).fail(function(e,t,n){console.debug("AJAX error: "+n)})},setStorageValue:function(e,t,n){var a=(new Date).getTime()+24*n*60*60*1e3,o={};try{!0===this._isLocalStorage()?(localStorage.removeItem(e),o=null!==n?{value:t,timestamp:a}:{value:t,timestamp:""},localStorage.setItem(e,JSON.stringify(o))):(null!==n&&(o={expires:n}),"undefined"!==$.fn.cookie&&$.cookie(e,t,o))}catch(n){console.log("localStorage Error: set("+e+", "+t+")"),console.log(n)}},getStorageValue:function(e){var t,n="";return this._isLocalStorage()?null!==(n=JSON.parse(localStorage.getItem(e)))&&n.timestamp<(new Date).getTime()?this.removeStorageValue(e):null!==n&&(t=n.value):"undefined"!==$.fn.cookie&&(t=$.cookie(e)),t},removeStorageValue:function(e){this._isLocalStorage()?localStorage.removeItem(e):$.cookie(e,null)},equalHeight:function(e){var t=0;e.each(function(){var e=$(this).height();e>t&&(t=e)}),e.height(t)},_isLocalStorage:function(){return"undefined"!=typeof Storage},_isMobileDevice:function(){if(navigator.userAgent.toLowerCase().match(/(Android|iPhone|iPad|iPod|Blackberry|Dolphin|IEMobile|WPhone|Windows Mobile|IEMobile9||IEMobile10||IEMobile11|Kindle|Mobile|MMP|MIDP|Pocket|PSP|Symbian|Smartphone|Sreo|Up.Browser|Up.Link|Vodafone|WAP|Opera Mini|Opera Tablet|Mobile|Fennec)/i)&&("ontouchstart"in window||navigator.msMaxTouchPoints>0||window.DocumentTouch&&document instanceof DocumentTouch))return!0}},t.view={init:function(){var e=this,t=$("#oe_sidebar > aside"),n=t.find(".toggle-button"),a=$("#oe_container"),o=$("#oe_pagemenu");t.on("click",function(t){t.preventDefault(),n.is(":visible")&&(a.hasClass("sidebar-on")?e._closeSidebar(a,o):e._showSidebar(a,o))}),e.toggleSubMenu(o,50),e.showNotifications(),e.setUIButtons(),e.setupAlerts(),e.updateDisplay(),e.handleSidebar(a);var i=0;$(window).on("resize",function(){if(0===i){var t=this;i=setTimeout(function(){var n=.01*t.innerHeight,o=.01*t.innerWidth;document.documentElement.style.setProperty("--vh",n+"px","important"),document.documentElement.style.setProperty("--vw",o+"px","important"),e.handleSidebar(a),e.updateDisplay(),i=0},100)}})},handleSidebar:function(e){var n=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;"sidebar-off"===t.helper.getStorageValue("sidebar-pref")||n<=768?e.addClass("sidebar-off").removeClass("sidebar-on"):e.addClass("sidebar-on").removeClass("sidebar-off")},toggleSubMenu:function(e,t){var n=this;e.find("li.current span").addClass("open-sub"),e.find("> li > span").on("click",function(){var a=$(this).next(),o=[];!1===a.is(":visible")&&o.push(e.find("ul").slideUp(t)),o.push(a.slideToggle(t)),$.when.apply($,o).done(function(){n.updateDisplay()})})},showNotifications:function(){$(".pagewarning, .message, .pageerrorcontainer, .pagemcontainer").prepend('<span class="close-warning"></span>'),$(document).on("click",".close-warning",function(){$(this).parent().hide(),$(this).parent().remove()});var e=$("body").attr("id")+"_notification";$(".pagewarning .close-warning").on("click",function(){t.helper.setStorageValue(e,"hidden",60)}),"hidden"===t.helper.getStorageValue(e)&&$(".pagewarning").addClass("hidden"),$(".message:not(.no-slide), .pageerrorcontainer:not(.no-slide), .pagemcontainer:not(.no-slide)").each(function(){var e=$(this);$(e).hide().slideDown(1e3,function(){window.setTimeout(function(){e.slideUp()},1e4)})}),$(document).on("cms_ajax_apply",function(e){$("button[name=cancel], button[name=m1_cancel]").fadeOut(),$("button[name=cancel], button[name=m1_cancel]").button("option","label",e.close),$("button[name=cancel], button[name=m1_cancel]").fadeIn();var t="";"Success"===e.response?t='<aside class="message pagemcontainer" role="status"><span class="close-warning">Close</span><p class="pagemessage">'+e.details+"</p></aside>":(t='<aside class="message pageerrorcontainer" role="alert"><span class="close-warning">Close</span><ul class="pageerror">',t+=e.details,t+="</ul></aside>");var n=0;$("body").append(t).slideDown(1e3,function(){n=window.setTimeout(function(){n=0,$(".message").slideUp(1e3,function(){$(this).remove()})},1e4)}),$(document).on("click",".close-warning",function(){n>0&&(window.clearTimeout(n),n=0),$(".message").slideUp(400,function(){$(this).remove()})})})},setUIButtons:function(){$("input[type=submit], :button[data-ui-icon]").each(function(){var e=$(this),t=e.data("uiIcon")||"ui-icon-circle-check",n=e.val(),a=$('<button></button>');e.hasClass("noautobtn")&&e.hasClass("no-ui-btn")||(e.is("[name*=apply]")?t=e.data("uiIcon")||"ui-icon-disk":e.is("[name*=cancel]")?t=e.data("uiIcon")||"ui-icon-circle-close":(e.is("[name*=resettodefault]")||"refresh"===e.attr("id"))&&(t=e.data("uiIcon")||"ui-icon-refresh")),e.is(":button")&&(n=e.text()),$(this.attributes).each(function(e,t){a.attr(t.name,t.value)}),a.button({icons:{primary:t},label:n}),e.replaceWith(a)}),$("a.pageback").addClass("ui-state-default ui-corner-all").prepend('<span class="ui-icon ui-icon-arrowreturnthick-1-w">').hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")})},updateDisplay:function(){var e=$("#oe_menu"),t=$("#admin-alerts"),n=$("header.header"),a=n.outerHeight()+n.offset().top;t.length&&(a=t.outerHeight()+t.offset().top),e.outerHeight()+a<$(window).height()?e.css({position:"fixed",top:a}):(e.css({position:"",top:""}),e.offset().top<$(window).scrollTop()&&$("html, body").animate({scrollTop:$("#oe_menu").offset().top},1e3))},_showSidebar:function(e,n){e.addClass("sidebar-on").removeClass("sidebar-off"),n.find("li.current ul").show(),t.helper.setStorageValue("sidebar-pref","sidebar-on",60)},_closeSidebar:function(e,n){e.removeClass("sidebar-on").addClass("sidebar-off"),n.find("li ul").hide(),t.helper.setStorageValue("sidebar-pref","sidebar-off",60)},_handleAlert:function(e){var t=$(e).closest(".alert-box"),n=t.data("alert-name");if(n)return $.ajax({method:"POST",url:cms_data.ajax_alerts_url,data:{op:"delete",alert:n}}).done(function(){t.slideUp(1e3),t.parent().children().length<=1&&(t.closest("div.ui-dialog-content").dialog("close"),$("#alert-noalerts").show(),$("a#alerts").closest("li").remove()),t.remove()}).fail(function(e,t,n){console.debug("problem deleting an alert: "+n)})},setupAlerts:function(){var e=this;$("a#alerts").on("click",function(e){e.preventDefault(),$("#alert-dialog").dialog()}),$(".alert-msg a,.alert-icon,.alert-remove").on("click",function(t){t.preventDefault(),e._handleAlert(t.target)})}}}(this,jQuery);