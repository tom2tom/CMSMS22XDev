tinymce.util.Tools.resolve('tinymce.PluginManager').add("filepicker_CP",function(e){e.settings.file_picker_types="file image media",e.settings.file_picker_callback=function(e,t,i){var n,r=window.innerHeight,a=r<650?Math.max(.8*r,250):600,c=(r=window.innerWidth)<950?Math.max(.8*r,250):900,l="i"+(new Date).getTime().toString(16);tinymce.activeEditor.dom.setAttrib(tinymce.activeEditor.dom.select("html"),"data-cmsfp-instance",l),top.document.CMSFileBrowser||(top.document.CMSFileBrowser={type:i.filetype});if(top.document.CMSFileBrowser.onselect=function(t,r){function a(e){var t,i,n=e.charAt(e.length-1);return(t=(i=("/"!==n&&"\\"!==n?e:e.slice(0,-1)).replace(/^.*[/\\]/g,"")).lastIndexOf("."))>0?i.slice(0,t):i}r="/"===r.charAt(0)?cmsms_tiny.root_url+r:cmsms_tiny.uploads_url+"/"+r;var c={};switch(i.filetype){case"image":c.alt=a(r);break;case"media":break;default:c.text=a(r)}e(r,c),top.document.CMSFileBrowser.onselect=null,n.close()},cmsms_tiny.filepicker_url){var s,o=cmsms_tiny.filepicker_url+"&m1_inst="+encodeURIComponent(l)+"&m1_type="+i.filetype+"&m1_useprefix=1";switch(i.filetype){case"image":s="imagebrowser_title";break;case"media":s="mediabrowser_title";break;default:s="filebrowser_title"}n=tinymce.activeEditor.windowManager.openUrl({title:cmsms_tiny[s],url:o,height:a,width:c,buttons:[{type:"cancel",text:"Close"}]})}}});