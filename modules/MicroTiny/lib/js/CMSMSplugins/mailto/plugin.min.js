tinymce.PluginManager.add("mailto",function(t){function e(){var e,n,i,o=t.selection.getNode();"A"==o.tagName&&t.dom.getAttrib(o,"href").startsWith("mailto:")?(n=t.dom.getAttrib(o,"href").replace("mailto:",""),i=(e=t.dom.getParent(o,'a[href^="mailto:"]')).innerText,console.log(o)):(n="",e=!1,i=t.selection.getContent({format:"text"})),t.windowManager.open({title:cmsms_tiny.mailto_heading,initialData:{email:n,text:i},body:{type:"panel",items:[{type:"input",name:"email",label:cmsms_tiny.prompt_email,size:40},{type:"input",name:"text",label:cmsms_tiny.prompt_linktext,size:40}]},buttons:[{type:"cancel",text:"Cancel"},{type:"submit",text:"Save",primary:!0}],onSubmit:function(n){var i,o=n.getData();i=o.text?o.text:o.email,e&&t.selection.select(e),t.execCommand("mceInsertContent",!1,t.dom.createHTML("a",{href:"mailto:"+o.email},i)),n.close()}})}function n(e){return function(e){var n=function(){return e.setEnabled(null!==function(t,e){return(e=e||t.selection.getNode())?t.dom.select('a[href^="mailto:"]',e)[0]:t.dom.getParent(e,'a[href^="mailto:"')}(t,t.selection.getNode()))};return n(),function(t,e){return t.on("NodeChange",e),function(){return t.off("NodeChange",e)}}(t,n)}}t.ui.registry.addMenuItem("mailto",{icon:"mailto",onAction:e,onSetup:n,text:cmsms_tiny.mailto_text+"..."}),t.ui.registry.addButton("mailto",{icon:"mailto",onAction:e,onSetup:n,tooltip:cmsms_tiny.mailto_title})});