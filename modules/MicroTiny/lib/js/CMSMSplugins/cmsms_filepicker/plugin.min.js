tinymce.PluginManager.add("cmsms_filepicker",function(e){e.options.register("file_picker_types",{processor:"string"}),e.options.set("file_picker_types","file image media"),e.options.register("file_picker_callback",{processor:"function"}),e.options.set("file_picker_callback",function(t,i,r){var s,n=window.innerHeight,l=n<650?Math.max(.8*n,250):600,c=(n=window.innerWidth)<950?Math.max(.8*n,250):900,o="i"+(new Date).getTime().toString(16);if(e.dom.setAttrib(e.dom.select("html"),"data-cmsfp-instance",o),top.document.CMSFileBrowser||(top.document.CMSFileBrowser={type:r.filetype}),top.document.CMSFileBrowser.onselect=function(e,i){function n(e){var t,i,r=e.charAt(e.length-1);return(t=(i=("/"!==r&&"\\"!==r?e:e.slice(0,-1)).replace(/^.*[/\\]/g,"")).lastIndexOf("."))>0?i.slice(0,t):i}i="/"===i.charAt(0)?cmsms_tiny.root_url+i:cmsms_tiny.uploads_url+"/"+i;var l={};switch(r.filetype){case"image":l.alt=n(i);break;case"media":break;default:l.text=n(i)}t(i,l),top.document.CMSFileBrowser.onselect=null,s.close()},void 0!==cmsms_tiny.filepicker_url&&cmsms_tiny.filepicker_url){var a,m=cmsms_tiny.filepicker_url+"&m1_inst="+encodeURIComponent(o)+"&m1_type="+r.filetype+"&m1_useprefix=1";switch(r.filetype){case"image":a="imagebrowser_title";break;case"media":a="mediabrowser_title";break;default:a="filebrowser_title"}s=e.windowManager.openUrl({title:cmsms_tiny[a],url:m,height:l,width:c,buttons:[{type:"cancel",text:"Close"}]})}})});
