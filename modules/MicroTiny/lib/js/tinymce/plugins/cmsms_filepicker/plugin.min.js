tinymce.PluginManager.add("cmsms_filepicker",function(e){return e.settings.file_picker_type="file image media",e.settings.file_picker_callback=function(e,i,t){var n,r,l;!function(e){n=600,r=900,e.innerHeight<650&&(n=Math.max(.8*e.innerHeight,250)),e.innerWidth<950&&(r=Math.max(.8*e.innerWidth,250))}(window);var c="i"+(new Date).getTime().toString(16);tinymce.activeEditor.dom.setAttrib(tinymce.activeEditor.dom.select("html"),"data-cmsfp-instance",c),top.document.CMSFileBrowser||(top.document.CMSFileBrowser={type:t.filetype});if(top.document.CMSFileBrowser.onselect=function(i,n){function r(e){var i,t,n=e.charAt(e.length-1);return(i=(t=("/"!==n&&"\\"!==n?e:e.slice(0,-1)).replace(/^.*[/\\]/g,"")).lastIndexOf("."))>0?t.slice(0,i):t}n="/"===n.charAt(0)?cms_data.root_url+n:cms_data.uploads_url+"/"+n;var c={};"file"===t.filetype?c.text=r(n):"image"===t.filetype&&(c.alt=r(n)),e(n,c),top.document.CMSFileBrowser.onselect=null,l.close()},void 0!==cmsms_tiny.filepicker_url&&cmsms_tiny.filepicker_url){var a=cmsms_tiny.filepicker_url+"&m1_inst="+encodeURIComponent(c)+"&m1_type="+t.filetype+"&m1_useprefix=1",s="image"===t.filetype?"imagebrowser_title":"filebrowser_title";l=tinymce.activeEditor.windowManager.open({title:cmsms_tiny[s],file:a,classes:"filepicker",height:n,width:r,inline:1,resizable:!0,maximizable:!0})}},!1});
