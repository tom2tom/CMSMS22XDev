tinymce.PluginManager.add("cmsms_filepicker",function(e){return e.settings.file_picker_type="file image media",e.settings.file_picker_callback=function(e,i,t){var n,l,c;!function(e){n=600,l=900,e.innerHeight<650&&(n=Math.max(.8*e.innerHeight,250)),e.innerWidth<950&&(l=Math.max(.8*e.innerWidth,250))}(window);var r="i"+(new Date).getTime().toString(16);tinymce.activeEditor.dom.setAttrib(tinyMCE.activeEditor.dom.select("html"),"data-cmsfp-instance",r),top.document.CMSFileBrowser||(top.document.CMSFileBrowser={});top.document.CMSFileBrowser.onselect=function(i,n){function l(e){var i,t,n,l=e.charAt(e.length-1);return i="/"!==l&&"\\"!==l?e:e.slice(0,-1),n=i.replace(/^.*[/\\]/g,""),(t=n.lastIndexOf("."))>0?n.slice(0,t):n}n=cms_data.uploads_url+"/"+n;var r={};"file"===t.filetype?r.text=l(n):"image"===t.filetype&&(r.alt=l(n)),e(n,r),top.document.CMSFileBrowser.onselect=null,c.close()};var a=cmsms_tiny.filepicker_url+"&inst="+r+"&type="+t.filetype+"&useprefix=1";c=tinymce.activeEditor.windowManager.open({title:cmsms_tiny.filepicker_title,file:a,classes:"filepicker",height:n,width:l,inline:1,resizable:!0,maximizable:!0},{onFileSelected:function(e){console.debug("woot got callback with "+e)}})},!1});