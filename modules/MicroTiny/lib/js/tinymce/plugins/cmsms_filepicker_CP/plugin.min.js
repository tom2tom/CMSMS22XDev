tinymce.PluginManager.add("cmsms_filepicker_CP",function(e){e.settings.file_picker_types="file image media",e.settings.file_picker_callback=function(e,t,i){var a,r=window.innerHeight,c=r<650?Math.max(.8*r,250):600,n=(r=window.innerWidth)<950?Math.max(.8*r,250):900,l="i"+(new Date).getTime().toString(16);tinymce.activeEditor.dom.setAttrib(tinymce.activeEditor.dom.select("html"),"data-cmsfp-instance",l),top.document.CMSFileBrowser||(top.document.CMSFileBrowser={type:i.filetype});if(top.document.CMSFileBrowser.onselect=function(t,r){function c(e){var t,i,a=e.charAt(e.length-1);return(t=(i=("/"!==a&&"\\"!==a?e:e.slice(0,-1)).replace(/^.*[/\\]/g,"")).lastIndexOf("."))>0?i.slice(0,t):i}r="/"===r.charAt(0)?cmsms_tiny.root_url+r:cmsms_tiny.uploads_url+"/"+r;var n={};switch(i.filetype){case"image":n.alt=c(r);break;case"media":break;default:n.text=c(r)}e(r,n),top.document.CMSFileBrowser.onselect=null,a.close()},void 0!==cmsms_tiny.filepicker_url&&cmsms_tiny.filepicker_url){var s,o=cmsms_tiny.filepicker_url+"&m1_inst="+encodeURIComponent(l)+"&m1_type="+i.filetype+"&m1_useprefix=1";switch(i.filetype){case"image":s="imagebrowser_title";break;case"media":s="mediabrowser_title";break;default:s="filebrowser_title"}a=tinymce.activeEditor.windowManager.openUrl({title:cmsms_tiny[s],url:o,height:c,width:n,buttons:[{type:"cancel",text:"Close"}]})}}});
