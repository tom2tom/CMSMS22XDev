/*!
jQuery Resize And Crop (jrac) 1.0.2 <https://github.com/trepmag/jrac>
(C) 2011-2015 Cedric Gampert <cgampert@gmail.com>
License GPL2
*/
!function($){$.fn.jrac=function(i){var t={crop_width:200,crop_height:100,crop_x:0,crop_y:0,crop_resize:!0,crop_aspect_ratio:null,image_width:null,image_height:null,zoom_min:100,zoom_max:3e3,zoom_label:"",viewport_image_surrounding:!1,viewport_width:null,viewport_height:null,viewport_resize:!0,viewport_content_left:0,viewport_content_top:0,viewport_onload:null};return this.each(function(){if($(this).is("img")){var o=!1;"object"==typeof i?$.extend(t,i):"destroy"==i&&(o=!0);var e=$(this),r=!1;if(e.parent().hasClass("jrac_viewport")&&(r=!0),r&&o?(e.draggable("destroy"),e.parent().find(".jrac_crop").remove(),e.parent().parent().find(".jrac_zoom_slider").remove(),e.parent().append(e.data("original")),e.parent().unwrap(),e.unwrap(),e.remove()):e.data("original",e.clone()),!o){r||e.hide().css("position","absolute").wrap('<div class="jrac_container"><div class="jrac_viewport"></div></div>');var a=e.parent(),n=a.parent(),_=$("<div></div>").addClass("jrac_loading");a.append(_);var s=function(){var i,o;if($.extend(e,{scale_proportion_locked:!0,originalWidth:e.width(),originalHeight:e.height()}),e.width(t.image_width).height(t.image_height),t.viewport_image_surrounding?a.width(e.width()).height(e.height()):a.width(t.viewport_width).height(t.viewport_height),e.css({left:t.viewport_content_left,top:t.viewport_content_top}),r){if(0===(i=a.find(".jrac_crop")).length)throw"jrac internal error";o=n.find(".jrac_zoom_slider")}else{if(t.zoom_label){var s=$('<div class="jrac_zoom_slider_label">'+t.zoom_label+"</div>");n.append(s)}o=$('<div class="jrac_zoom_slider"><div class="ui-slider-handle"></div></div>').slider({value:e.width(),min:t.zoom_min,max:t.zoom_max,start:function(i,t){$.extend(o,{on_start_width_value:t.value,on_start_height_value:e.height()})},slide:function(i,t){var r=Math.round(o.on_start_height_value*t.value/o.on_start_width_value);e.height(r),e.width(t.value),a.observator.notify("jrac_image_height",r),a.observator.notify("jrac_image_width",t.value)}}),n.append(o),t.viewport_resize&&a.resizable(),e.draggable({drag:function(i,t){t.position.left!=t.originalPosition.left&&a.observator.notify("jrac_crop_x",a.observator.crop_position_x()),t.position.top!=t.originalPosition.top&&a.observator.notify("jrac_crop_y",a.observator.crop_position_y())}}),i=$('<div class="jrac_crop"><div class="jrac_crop_drag_handler"></div></div>').css({width:t.crop_width,height:t.crop_height,left:t.crop_x+t.viewport_content_left,top:t.crop_y+t.viewport_content_top}).draggable({containment:a,handle:"div.jrac_crop_drag_handler",drag:function(i,t){t.position.left!=t.originalPosition.left&&a.observator.notify("jrac_crop_x",a.observator.crop_position_x()),t.position.top!=t.originalPosition.top&&a.observator.notify("jrac_crop_y",a.observator.crop_position_y())}}),t.crop_resize&&i.resizable({containment:a,aspectRatio:t.crop_aspect_ratio,resize:function(t,o){o.size.width!=o.originalSize.width&&a.observator.notify("jrac_crop_width",i.width()),o.size.height!=o.originalSize.height&&a.observator.notify("jrac_crop_height",i.height())}}),a.append(i)}$.extend(a,{$container:n,$image:e,$crop:i,$zoom_widget:o,observator:{items:{},register:function(i,t,o){i&&t&&(this.items[i]={element:t,callback:o})},unregister:function(i){delete this.items[i]},notify:function(i,t){if(this.items[i]){var o=this.items[i].element,r=this.items[i].callback;o.trigger(i,[a,t]),"function"==typeof r&&r.call(a,i,o,t)}e.trigger("jrac_events",[a])},notify_all:function(){this.notify("jrac_crop_x",this.crop_position_x()),this.notify("jrac_crop_y",this.crop_position_y()),this.notify("jrac_crop_width",i.width()),this.notify("jrac_crop_height",i.height()),this.notify("jrac_image_width",e.width()),this.notify("jrac_image_height",e.height())},crop_position_x:function(){return i.position().left-e.position().left},crop_position_y:function(){return i.position().top-e.position().top},crop_consistent:function(){return this.crop_position_x()>=0&&this.crop_position_y()>=0&&this.crop_position_x()+i.width()+2*parseInt(i.css("border-width"),10)<=e.width()&&this.crop_position_y()+i.height()+2*parseInt(i.css("border-width"),10)<=e.height()},set_property:function(t,r){if(r=parseInt(r),!isNaN(r)){switch(t){case"jrac_crop_x":i.css("left",r+e.position().left);break;case"jrac_crop_y":i.css("top",r+e.position().top);break;case"jrac_crop_width":i.width(r);break;case"jrac_crop_height":i.height(r);break;case"jrac_image_width":if(e.scale_proportion_locked){var a=Math.round(e.height()*r/e.width());e.height(a),this.notify("jrac_image_height",a)}e.width(r),o.slider("value",r);break;case"jrac_image_height":if(e.scale_proportion_locked){var n=Math.round(e.width()*r/e.height());e.width(n),this.notify("jrac_image_width",n),o.slider("value",n)}e.height(r)}this.notify(t,r)}}}}),_.hide(),_.remove(),e.show(),"function"==typeof t.viewport_onload&&(t.viewport_onload.call(a),a.observator.notify_all())},c=e.attr("src");/^data:image/.test(c)?s():(c=c+(c.search(/\?/)<0?"?":"&")+"jracrandom="+(new Date).getTime(),$("<img/>").attr("src",c).load(s))}}})}}(jQuery);