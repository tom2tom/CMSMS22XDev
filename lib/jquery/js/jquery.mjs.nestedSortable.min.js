/*!
jQuery UI Nested Sortable v.2.2 <https://github.com/ilikenwf/nestedSortable>
(C) 2010-2022 Manuele J Sarfatti and contributors
License MIT
*/
!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery-ui/ui/sortable"],e):e(window.jQuery)}(function($){"use strict";function e(e,t,s){return e>t&&e<t+s}$.widget("mjs.nestedSortable",$.ui.sortable,{options:{disableParentChange:!1,doNotClear:!1,expandOnHover:700,isAllowed:function(){return!0},isTree:!1,listType:"ol",maxLevels:0,protectRoot:!1,rootID:null,rtl:!1,startCollapsed:!1,tabSize:20,branchClass:"mjs-nestedSortable-branch",collapsedClass:"mjs-nestedSortable-collapsed",disableNestingClass:"mjs-nestedSortable-no-nesting",errorClass:"mjs-nestedSortable-error",expandedClass:"mjs-nestedSortable-expanded",hoveringClass:"mjs-nestedSortable-hovering",leafClass:"mjs-nestedSortable-leaf",disabledClass:"mjs-nestedSortable-disabled"},_create:function(){var e=this;if(this.element.data("uiSortable",this.element.data("mjsNestedSortable")),!this.element.is(this.options.listType))throw"nestedSortable: Please check that the listType option is set to your actual list type",new Error("nestedSortable: Please check that the listType option is set to your actual list type");this.options.isTree&&this.options.expandOnHover&&(this.options.tolerance="intersect"),this._superApply(arguments),this.options.isTree&&$(this.items).each(function(){var t=this.item,s=t.hasClass(e.options.collapsedClass),i=t.hasClass(e.options.expandedClass);t.children(e.options.listType).length?(t.addClass(e.options.branchClass),s||i||(e.options.startCollapsed?t.addClass(e.options.collapsedClass):t.addClass(e.options.expandedClass))):t.addClass(e.options.leafClass)})},_destroy:function(){return this.element.removeData("mjsNestedSortable").removeData("uiSortable"),this._superApply(arguments)},_mouseDrag:function(e){var t,s,i,o,l,r,n,a,h,p,d,c,u,f,m,g,v=this,C=this.options,b=!1,_=$(document);for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<C.scrollSensitivity?(b=this.scrollParent.scrollTop()+C.scrollSpeed,this.scrollParent.scrollTop(b)):e.pageY-this.overflowOffset.top<C.scrollSensitivity&&(b=this.scrollParent.scrollTop()-C.scrollSpeed,this.scrollParent.scrollTop(b)),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<C.scrollSensitivity?(b=this.scrollParent.scrollLeft()+C.scrollSpeed,this.scrollParent.scrollLeft(b)):e.pageX-this.overflowOffset.left<C.scrollSensitivity&&(b=this.scrollParent.scrollLeft()-C.scrollSpeed,this.scrollParent.scrollLeft(b))):(e.pageY-_.scrollTop()<C.scrollSensitivity?(b=_.scrollTop()-C.scrollSpeed,_.scrollTop(b)):$(window).height()-(e.pageY-_.scrollTop())<C.scrollSensitivity&&(b=_.scrollTop()+C.scrollSpeed,_.scrollTop(b)),e.pageX-_.scrollLeft()<C.scrollSensitivity?(b=_.scrollLeft()-C.scrollSpeed,_.scrollLeft(b)):$(window).width()-(e.pageX-_.scrollLeft())<C.scrollSensitivity&&(b=_.scrollLeft()+C.scrollSpeed,_.scrollLeft(b))),!1!==b&&$.ui.ddmanager&&!C.dropBehaviour&&$.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),l=this.placeholder.offset().top,this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),this.hovering=this.hovering?this.hovering:null,this.mouseentered=!!this.mouseentered&&this.mouseentered,function(){var e=this.placeholder.parent().parent();e&&e.closest(".ui-sortable").length&&(r=e)}.call(this),n=this._getLevel(this.placeholder),a=this._getChildLevels(this.helper),d=document.createElement(C.listType),this.dragDirection={vertical:this._getDragVerticalDirection(),horizontal:this._getDragHorizontalDirection()},t=this.items.length-1;t>=0;t--)if(s=this.items[t],i=s.item[0],(o=this._intersectsWithPointer(s))&&s.instance===this.currentContainer){if(-1!==i.className.indexOf(C.disabledClass))if(2===o){if((h=this.items[t+1])&&h.item.hasClass(C.disabledClass))continue}else if((p=this.items[t-1])&&p.item.hasClass(C.disabledClass))continue;if(c=1===o?"next":"prev",!(i===this.currentItem[0]||this.placeholder[c]()[0]===i||$.contains(this.placeholder[0],i)||"semi-dynamic"===this.options.type&&$.contains(this.element[0],i))){if(this.mouseentered||($(i).trigger("mouseenter"),this.mouseentered=!0),C.isTree&&$(i).hasClass(C.collapsedClass)&&C.expandOnHover&&(this.hovering||($(i).addClass(C.hoveringClass),this.hovering=window.setTimeout(function(){$(i).removeClass(C.collapsedClass).addClass(C.expandedClass),v.refreshPositions(),v._trigger("expand",e,[v._uiHash(),i])},C.expandOnHover))),this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;$(i).trigger("mouseleave"),this.mouseentered=!1,$(i).removeClass(C.hoveringClass),this.hovering&&window.clearTimeout(this.hovering),this.hovering=null,!C.protectRoot||this.currentItem[0].parentNode===this.element[0]&&i.parentNode!==this.element[0]?C.protectRoot||this._rearrange(e,s):this.currentItem[0].parentNode!==this.element[0]&&i.parentNode===this.element[0]?($(i).children(C.listType).length||(i.appendChild(d),C.isTree&&$(i).removeClass(C.leafClass).addClass(C.branchClass+" "+C.expandedClass)),void 0!==(u="down"===this.direction?$(i).prev().children(C.listType):$(i).children(C.listType))[0]&&this._rearrange(e,null,u)):this._rearrange(e,s),this._clearEmpty(i),this._trigger("change",e,this._uiHash());break}}if(function(){var e=this.placeholder.prev();f=e.length?e:null}.call(this),null!=f)for(;"li"!==f[0].nodeName.toLowerCase()||-1!==f[0].className.indexOf(C.disabledClass)||f[0]===this.currentItem[0]||f[0]===this.helper[0];){if(!f[0].previousSibling){f=null;break}f=$(f[0].previousSibling)}if(function(){var e=this.placeholder.next();m=e.length?e:null}.call(this),null!=m)for(;"li"!==m[0].nodeName.toLowerCase()||-1!==m[0].className.indexOf(C.disabledClass)||m[0]===this.currentItem[0]||m[0]===this.helper[0];){if(!m[0].nextSibling){m=null;break}m=$(m[0].nextSibling)}return this.beyondMaxLevels=0,null==r||null!=m||C.protectRoot&&r[0].parentNode==this.element[0]||!(C.rtl&&this.positionAbs.left+this.helper.outerWidth()>r.offset().left+r.outerWidth()||!C.rtl&&this.positionAbs.left<r.offset().left)?null==f||f.hasClass(C.disableNestingClass)||!(f.children(C.listType).length&&f.children(C.listType).is(":visible")||!f.children(C.listType).length)||C.protectRoot&&this.currentItem[0].parentNode===this.element[0]||!(C.rtl&&this.positionAbs.left+this.helper.outerWidth()<f.offset().left+f.outerWidth()-C.tabSize||!C.rtl&&this.positionAbs.left>f.offset().left+C.tabSize)?this._isAllowed(r,n,n+a):(this._isAllowed(f,n,n+a+1),f.children(C.listType).length||(f[0].appendChild(d),C.isTree&&f.removeClass(C.leafClass).addClass(C.branchClass+" "+C.expandedClass)),l&&l<=f.offset().top?f.children(C.listType).prepend(this.placeholder):f.children(C.listType)[0].appendChild(this.placeholder[0]),void 0!==r&&this._clearEmpty(r[0]),this._trigger("change",e,this._uiHash())):(r.after(this.placeholder[0]),g=!r.children(C.listItem).children("li:visible:not(.ui-sortable-helper)").length,C.isTree&&g&&r.removeClass(this.options.branchClass+" "+this.options.expandedClass).addClass(this.options.leafClass),void 0!==r&&this._clearEmpty(r[0]),this._trigger("change",e,this._uiHash())),this._contactContainers(e),$.ui.ddmanager&&$.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e){this.beyondMaxLevels&&(this.placeholder.removeClass(this.options.errorClass),this.domPosition.prev?$(this.domPosition.prev).after(this.placeholder):$(this.domPosition.parent).prepend(this.placeholder),this._trigger("revert",e,this._uiHash())),$("."+this.options.hoveringClass).trigger("mouseleave").removeClass(this.options.hoveringClass),this.mouseentered=!1,this.hovering&&window.clearTimeout(this.hovering),this.hovering=null,this._relocate_event=e,this._pid_current=$(this.domPosition.parent).parent().attr("id"),this._sort_current=this.domPosition.prev?$(this.domPosition.prev).next().index():0,this._superApply(arguments)},_intersectsWithSides:function(t){var s=this.options.isTree?.8:.5,i=e(this.positionAbs.top+this.offset.click.top,t.top+t.height*s,t.height),o=e(this.positionAbs.top+this.offset.click.top,t.top-t.height*s,t.height),l=e(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),r=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&l||"left"===n&&!l:r&&("down"===r&&i||"up"===r&&o)},_contactContainers:function(){this.options.protectRoot&&this.currentItem[0].parentNode===this.element[0]||this._superApply(arguments)},_clear:function(){var e,t;for(this._superApply(arguments),this._pid_current===this._uiHash().item.parent().parent().attr("id")&&this._sort_current===this._uiHash().item.index()||this._trigger("relocate",this._relocate_event,this._uiHash()),e=this.items.length-1;e>=0;e--)t=this.items[e].item[0],this._clearEmpty(t)},serialize:function(e){var t=$.extend({},this.options,e),s=this._getItemsAsjQuery(t&&t.connected),i=[];return $(s).each(function(){var e=($(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[-=_](.+)/),s=($(t.item||this).parent(t.listType).parent(t.items).attr(t.attribute||"id")||"").match(t.expression||/(.+)[-=_](.+)/);e&&i.push((t.key||e[1])+"["+(t.key&&t.expression?e[1]:e[2])+"]="+(s?t.key&&t.expression?s[1]:s[2]:t.rootID))}),!i.length&&t.key&&i.push(t.key+"="),i.join("&")},toHierarchy:function(e){var t=$.extend({},this.options,e),s=[];return $(this.element).children(t.items).each(function(){var e=function e(s){var i,o=($(s).attr(t.attribute||"id")||"").match(t.expression||/(.+)[-=_](.+)/);var l=$(s).data();l.nestedSortableItem&&delete l.nestedSortableItem;if(o)return i={id:o[2]},i=$.extend({},i,l),$(s).children(t.listType).children(t.items).length>0&&(i.children=[],$(s).children(t.listType).children(t.items).each(function(){var t=e(this);i.children.push(t)})),i}(this);s.push(e)}),s},toArray:function(e){var t=$.extend({},this.options,e),s=t.startDepthCount||0,i=[],o=1;return t.excludeRoot||(i.push({item_id:t.rootID,parent_id:null,depth:s,left:o,right:2*($(t.items,this.element).length+1)}),o++),$(this.element).children(t.items).each(function(){o=function e(o,l,r){var n,a,h,p=r+1;$(o).children(t.listType).children(t.items).length>0&&(l++,$(o).children(t.listType).children(t.items).each(function(){p=e($(this),l,p)}),l--);n=($(o).attr(t.attribute||"id")||"").match(t.expression||/(.+)[-=_](.+)/);l===s?a=t.rootID:(h=$(o).parent(t.listType).parent(t.items).attr(t.attribute||"id").match(t.expression||/(.+)[-=_](.+)/),a=h[2]);if(n){var d=$(o).children("div").data(),c=$.extend(d,{id:n[2],parent_id:a,depth:l,left:r,right:p});i.push(c)}r=p+1;return r}(this,s,o)}),i=i.sort(function(e,t){return e.left-t.left})},_clearEmpty:function(e){var t,s,i,o=this.options,l=$(e).children(o.listType),r=l.has("li").length,n=o.doNotClear||r||o.protectRoot&&$(e)[0]===this.element[0];o.isTree&&(t=e,s=o.branchClass,i=o.leafClass,n&&(s=[i,i=s][0]),$(t).removeClass(s).addClass(i)),n||(l.parent().removeClass(o.expandedClass),l.remove())},_getLevel:function(e){var t,s=1;if(this.options.listType)for(t=e.closest(this.options.listType);t&&t.length>0&&!t.is(".ui-sortable");)s++,t=t.parent().closest(this.options.listType);return s},_getChildLevels:function(e,t){var s=this,i=this.options,o=0;return t=t||0,$(e).children(i.listType).children(i.items).each(function(e,i){o=Math.max(s._getChildLevels(i,t+1),o)}),t?o+1:o},_isAllowed:function(e,t,s){var i=this.options,o=this.placeholder.closest(".ui-sortable").nestedSortable("option","maxLevels"),l=this.currentItem.parent().parent();i.disableParentChange&&(void 0!==e&&!l.is(e)||void 0===e&&l.is("li"))||!i.isAllowed(this.placeholder,e,this.currentItem)?(this.placeholder.addClass(i.errorClass),this.beyondMaxLevels=o<s&&0!==o?s-o:1):o<s&&0!==o?(this.placeholder.addClass(i.errorClass),this.beyondMaxLevels=s-o):(this.placeholder.removeClass(i.errorClass),this.beyondMaxLevels=0)}}),$.mjs.nestedSortable.prototype.options=$.extend({},$.ui.sortable.prototype.options||{},$.mjs.nestedSortable.prototype.options||{})});
